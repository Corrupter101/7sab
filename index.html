<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¶Ù…ÙŠÙ†</title>
<!-- ØªØ¶Ù…ÙŠÙ† Ù…ÙƒØªØ¨Ø© ResponsiveVoice Ø£ÙˆÙ„Ø§Ù‹ -->
<script src="https://code.responsivevoice.org/responsivevoice.js?key=WIZiyVE9"></script>
<style>
    body {
      font-family: 'Tajawal', sans-serif;
      margin: 0 auto;
      padding: 0;
      background-color: black;
      color: white;
      max-width: 500px;
      zoom: 0.9;
    }
    .player {
      background-color: #222;
      padding: 10px;
      margin: 10px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .player input[type="text"], .player input[type="number"] {
      padding: 8px;
      margin: 5px;
    }
    .player input[type="text"] { width: 25%; }
    .player input[type="number"] { width: 15%; }
    .player button { width: 15%; font-size: 18px; }
    .player .total { width: 20%; text-align: center; font-weight: bold; color: #FFD700; }
    button {
      padding: 8px 12px;
      margin: 5px;
      border-radius: 10px;
      font-size: 16px;
    }
    #announceBtn {
      background-color: #28a745;
      font-size: 18px;
      font-weight: bold;
      width: 90%;
      display: block;
      margin: 15px auto;
    }
    #roundRecords {
      background-color: #111;
      padding: 10px;
      margin: 10px;
      border-radius: 10px;
      border: 1px solid #333;
    }
    #roundRecords ul {
      padding: 0;
      list-style: none;
    }
    #roundRecords li {
      padding: 5px;
      border-bottom: 1px solid #333;
      font-size: 14px;
    }
    #controls {
      text-align: center;
      margin-top: 10px;
    }
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© */
    #gameEndModal, #settingsModal, #settingsModalOverlay {
      display: none;
    }
    #gameEndModal {
      position: fixed;
      z-index: 1000;
      padding: 30px;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      text-align: center;
      font-family: 'Tajawal', sans-serif;
      color: #000;
    }
    #gameEndModal h2 {
      margin-top: 0;
      color: #2e8b57;
      font-size: 22px;
    }
    #gameEndModal p { margin: 5px 0; font-size: 18px; }
    #gameEndModal button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      background-color: #2e8b57;
      color: white;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }
    #gameEndModal button:hover { background-color: #1f5f3d; }

    /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
    #settingsModalOverlay {
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
    }
    #settingsModal {
      position: fixed;
      z-index: 1000;
      padding: 20px;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      color: #000;
      min-width: 300px;
      font-family: 'Tajawal', sans-serif;
    }
    #settingsModal h3 {
      margin-top: 0;
      font-size: 20px;
      color: #2e8b57;
    }
  </style>
</head>
<body><h1 style="text-align: center; margin-top: 10px; color: #FFD700;">Ù‚ÙŠØ¯ Ø§Ù„Ø³Ø¨ÙŠØªÙ‡</h1>
<!-- ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
<audio id="notifySound" preload="auto" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
<!-- Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
<div class="player">
<input placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" type="text"/>
<input class="points" placeholder="" type="number" value=""/>
<button onclick="adjustPoints(this, 'subtract')">â–</button>
<button onclick="adjustPoints(this, 'add')">â•</button>
<div class="total">0</div>
</div>
<div class="player">
<input placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" type="text"/>
<input class="points" placeholder="" type="number" value=""/>
<button onclick="adjustPoints(this, 'subtract')">â–</button>
<button onclick="adjustPoints(this, 'add')">â•</button>
<div class="total">0</div>
</div>
<div class="player">
<input placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" type="text"/>
<input class="points" placeholder="" type="number" value=""/>
<button onclick="adjustPoints(this, 'subtract')">â–</button>
<button onclick="adjustPoints(this, 'add')">â•</button>
<div class="total">0</div>
</div>
<div class="player">
<input placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" type="text"/>
<input class="points" placeholder="" type="number" value=""/>
<button onclick="adjustPoints(this, 'subtract')">â–</button>
<button onclick="adjustPoints(this, 'add')">â•</button>
<div class="total">0</div>
</div>
<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="controls">
<button id="announceBtn" onclick="announceResults()">ğŸ“¢ Ù†Ø´Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
<button onclick="confirmNewGame()">ğŸ® Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯</button>
<button onclick="confirmClearRecords()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
<button id="settingsBtn">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>
<!-- Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª -->
<div id="roundRecords">
<h3>Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</h3>
<ul id="recordsList"></ul>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
<div id="gameEndModal">
<h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
<p id="winnerText"></p>
<p id="loserText"></p>
<button onclick="restartSamePlayers()">Ø¨Ø¯Ø¡ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</button>
<button onclick="restartWithNewPlayers()">Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¬Ø¯Ø¯</button>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="settingsModalOverlay"></div>
<div id="settingsModal">
<h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
<label>
<input checked="" id="toggleSound" type="checkbox"/> ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØµÙˆØª
    </label><br/><br/>
<label>Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØª:
      <select id="voiceSelect">
<option value="Arabic Male">Arabic Male</option>
<option value="Arabic Female">Arabic Female</option>
</select>
</label><br/><br/>
<label>Ø§Ù„Ø³Ù…Ø©:
      <select id="themeSelect">
<option value="dark">Ø¯Ø§ÙƒÙ†</option>
<option value="light">ÙØ§ØªØ­</option>
</select>
</label><br/><br/>
<button onclick="saveSettings()">Ø­ÙØ¸</button>
<button onclick="closeSettings()">Ø¥Ù„ØºØ§Ø¡</button>
</div>
<script>
    let roundNumber = 1;
    let lastTotals = [0, 0, 0, 0];
    let soundEnabled = true;
    let selectedVoice = 'Arabic Male';
    let theme = 'dark';

    function applyTheme() {
      if (theme === 'light') {
        document.body.style.backgroundColor = '#fff';
        document.body.style.color = '#000';
        document.querySelectorAll('.player').forEach(el => {
          el.style.backgroundColor = '#eee';
          el.style.color = '#000';
        });
        document.getElementById('announceBtn').style.backgroundColor = '#4CAF50';
      } else {
        document.body.style.backgroundColor = 'black';
        document.body.style.color = 'white';
        document.querySelectorAll('.player').forEach(el => {
          el.style.backgroundColor = '#222';
          el.style.color = 'white';
        });
        document.getElementById('announceBtn').style.backgroundColor = '#28a745';
      }
    }

    function speakText(text) {
      if (soundEnabled) {
        responsiveVoice.speak(text, selectedVoice);
      }
    }

    function playNotifySound() {
      if (soundEnabled) {
        document.getElementById('notifySound').play();
      }
    }

    function addSukoonToLastLetter(word) {
      return word.replace(/(.)$/, '$1Ù’');
    }

    function adjustPoints(button, action) {
      const container = button.closest('.player');
      const input = container.querySelector('.points');
      const totalDiv = container.querySelector('.total');

      const value = parseInt(input.value || 0);
      let total = parseInt(totalDiv.textContent || 0);

      if (!isNaN(value)) {
        if (action === 'add') {
          total += value;
        } else if (action === 'subtract') {
          total -= value;
        }
        totalDiv.textContent = total;
        input.value = '';
      }
    }

    function announceResults() {
      const players = document.querySelectorAll('.player');
      const currentTotals = [];
      let totalsChanged = false;

      const results = [];
      players.forEach((player, index) => {
        const name = player.querySelector('input[type="text"]').value || 'Ù„Ø§Ø¹Ø¨';
        const total = parseInt(player.querySelector('.total').textContent || 0);
        currentTotals[index] = total;
        if (total !== lastTotals[index]) {
          totalsChanged = true;
        }
        results.push(`${name} ${total}`);
      });

      if (totalsChanged) {
        const record = document.createElement('li');
        record.textContent = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${roundNumber}: ` + results.join(' | ');
        document.getElementById('recordsList').appendChild(record);
        roundNumber++;
        lastTotals = currentTotals;
      }

      let winner = '';
      let loser = '';
      let minPoints = Infinity;
      let maxPoints = -Infinity;

      players.forEach((player) => {
        const name = player.querySelector('input[type="text"]').value || 'Ù„Ø§Ø¹Ø¨';
        const total = parseInt(player.querySelector('.total').textContent || 0);
        if (total < minPoints) {
          minPoints = total;
          winner = name;
        }
        if (total > maxPoints) {
          maxPoints = total;
          loser = name;
        }
      });

      const khabsahLine =
        maxPoints >= 159
          ? 'ÙØ§Ø±Øª ÙÙŠ ÙˆØ¬Ù‡ ' + addSukoonToLastLetter(loser)
          : 'Ø§Ù„Ø®ÙØ¨Ù’ØµÙØ© Ø¹Ù†Ø¯ ' + addSukoonToLastLetter(loser);

      const spokenResults = [];
      players.forEach((player) => {
        const name = player.querySelector('input[type="text"]').value || 'Ù„Ø§Ø¹Ø¨';
        const total = parseInt(player.querySelector('.total').textContent || 0);
        spokenResults.push(`${addSukoonToLastLetter(name)} ${total}`);
      });

      speakText(spokenResults.join('. ') + '. ' + khabsahLine);

      responsiveVoice.onend = function () {
        if (maxPoints >= 159) {
          const winnerText = document.getElementById('winnerText');
          const loserText = document.getElementById('loserText');
          const modal = document.getElementById('gameEndModal');
          const overlay = document.getElementById('settingsModalOverlay');

          winnerText.textContent = `Ø§Ù„ÙØ§Ø¦Ø²: ${winner} (${minPoints})`;
          loserText.textContent = `Ø§Ù„Ø®Ø§Ø³Ø±: ${loser} (${maxPoints})`;
          modal.style.display = 'block';
          overlay.style.display = 'none';
          playNotifySound();
        }
        responsiveVoice.onend = null;
      };
    }

    function clearRecords() {
      document.getElementById('recordsList').innerHTML = '';
      document.querySelectorAll('.total').forEach((div) => (div.textContent = 0));
      lastTotals = [0, 0, 0, 0];
      roundNumber = 1;
    }

    function confirmClearRecords() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ')) clearRecords();
    }

    function restartSamePlayers() {
      document.querySelectorAll('.total').forEach((div) => (div.textContent = 0));
      document.querySelectorAll('.points').forEach((input) => (input.value = ''));
      lastTotals = [0, 0, 0, 0];
      roundNumber = 1;
      document.getElementById('gameEndModal').style.display = 'none';
    }

    function restartWithNewPlayers() {
      document.querySelectorAll('.total').forEach((div) => (div.textContent = 0));
      document.querySelectorAll('.points').forEach((input) => (input.value = ''));
      document.querySelectorAll('input[type="text"]').forEach((input) => (input.value = ''));
      lastTotals = [0, 0, 0, 0];
      roundNumber = 1;
      document.getElementById('gameEndModal').style.display = 'none';
    }

    function confirmNewGame() {
      if (confirm('Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¨Ø¯Ø¡ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŸ')) {
        restartSamePlayers();
      } else if (confirm('Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¬Ø¯Ø¯ØŸ')) {
        restartWithNewPlayers();
      }
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    document.getElementById('settingsBtn').addEventListener('click', function() {
      document.getElementById('settingsModalOverlay').style.display = 'block';
      document.getElementById('settingsModal').style.display = 'block';
    });

    function closeSettings() {
      document.getElementById('settingsModalOverlay').style.display = 'none';
      document.getElementById('settingsModal').style.display = 'none';
    }

    function saveSettings() {
      soundEnabled = document.getElementById('toggleSound').checked;
      selectedVoice = document.getElementById('voiceSelect').value;
      theme = document.getElementById('themeSelect').value;
      applyTheme();
      closeSettings();
    }

    applyTheme();
  </script>
</body>
</html>